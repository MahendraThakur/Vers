function Vers(t){return this instanceof Vers?(this._opts=t||{},this._maxVersion=this._opts.latest||-(1/0),this._pathCache={},this._converters={},void(this._getVersion=this._opts.getVersion||function(t){return t.hasOwnProperty("version")?t.version:1})):new Vers(t)}Vers.prototype.addConverter=function(t,e,r,n){this._pathCache={},this._converters[t]||(this._converters[t]={}),this._converters[t][e]=this._wrapConverter(r),n&&(this._converters[e]||(this._converters[e]={}),this._converters[e][t]=this._wrapConverter(n)),this._opts.latest||(this._maxVersion=Math.max(this._maxVersion,t,e))},Vers.prototype.fromTo=function(t,e,r){return new Promise(function(n){if(t===e)n(r);else{var o=this._getPath(t,e),s=Promise.resolve(r);o.forEach(function(t){s=s.then(t)}),n(s)}}.bind(this))},Vers.prototype.fromToLatest=function(t,e){return this.fromTo(t,this._maxVersion,e)},Vers.prototype.to=function(t,e){return Promise.resolve().then(function(){return this._getVersion(e)}.bind(this)).then(function(r){if(!r&&0!==r)throw new Error("Could not determine the current version");return this.fromTo(r,t,e)}.bind(this))},Vers.prototype.toLatest=function(t){return this.to(this._maxVersion,t)},Vers.prototype._findPath=function(t,e,r){var n=r||{};if(!this._converters[t]||n[t])return null;if(this._converters[t][e])return[this._converters[t][e]];n[t]=!0;var o=Object.keys(this._converters[t]),s=o.map(function(r){var o=this._findPath(r,e,n);return o?(o.push(this._converters[t][r]),o):null},this);return s.reduce(function(t,e){return t?e&&t.length>e.length?e:t:e})},Vers.prototype._getPath=function(t,e){if(this._pathCache[t]||(this._pathCache[t]={}),!this._pathCache[t][e]){var r=this._findPath(t,e);if(!r)throw new Error("No translation path found to convert "+t+" to "+e);r.reverse(),this._pathCache[t][e]=r}return this._pathCache[t][e]},Vers.prototype._wrapConverter=function(t){return function(e){return Promise.resolve(t(e)).then(function(t){return t||e})}},"undefined"!=typeof module&&module.exports&&(module.exports=Vers);