(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Vers=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){function Vers(options){if(!(this instanceof Vers)){return new Vers(options)}this._opts=options||{};this._maxVersion=this._opts.latest||-Infinity;this._pathCache={};this._converters={};this._getVersion=this._opts.getVersion||function(obj){return obj.hasOwnProperty("version")?obj.version:1}}Vers.prototype.addConverter=function(fromVer,toVer,forward,back){this._pathCache={};if(!this._converters[fromVer]){this._converters[fromVer]={}}this._converters[fromVer][toVer]=this._wrapConverter(forward);if(back){if(!this._converters[toVer]){this._converters[toVer]={}}this._converters[toVer][fromVer]=this._wrapConverter(back)}if(!this._opts.latest){this._maxVersion=Math.max(this._maxVersion,fromVer,toVer)}};Vers.prototype.fromTo=function(current,target,obj){return new Promise(function(resolve){if(current===target){resolve(obj)}else{var path=this._getPath(current,target);var conversionChain=Promise.resolve(obj);path.forEach(function(func){conversionChain=conversionChain.then(func)});resolve(conversionChain)}}.bind(this))};Vers.prototype.fromToLatest=function(current,obj){return this.fromTo(current,this._maxVersion,obj)};Vers.prototype.to=function(target,obj){return Promise.resolve().then(function(){return this._getVersion(obj)}.bind(this)).then(function(current){if(!current&&current!==0){throw new Error("Could not determine the current version")}return this.fromTo(current,target,obj)}.bind(this))};Vers.prototype.toLatest=function(obj){return this.to(this._maxVersion,obj)};Vers.prototype._findPath=function(cur,target,visited){var visits=visited||{};if(!this._converters[cur]||visits[cur]){return null}else if(this._converters[cur][target]){return[this._converters[cur][target]]}visits[cur]=true;var possibilities=Object.keys(this._converters[cur]);var paths=possibilities.map(function(test){var pathToEnd=this._findPath(test,target,visits);if(pathToEnd){pathToEnd.push(this._converters[cur][test])}return pathToEnd},this);return paths.reduce(function(e1,e2){if(!e1)return e2;else if(!e2)return e1;return e1.length>e2.length?e2:e1})};Vers.prototype._getPath=function(start,end){if(!this._pathCache[start]){this._pathCache[start]={}}if(!this._pathCache[start][end]){var path=this._findPath(start,end);if(!path){throw new Error("No translation path found to convert "+start+" to "+end)}path.reverse();this._pathCache[start][end]=path}return this._pathCache[start][end]};Vers.prototype._wrapConverter=function(func){return function(obj){return Promise.resolve(func(obj)).then(function(res){return res||obj})}};module.exports=Vers},{}]},{},[1])(1)});
